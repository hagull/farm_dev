{% extends "control/layout.html" %}

{% block content %}
{% load palm_filters %}

<div class="control-nav">
  <div class="control-inner" style="position:relative; ">
    <form action="" method="get">
        {% if user.allhousecctv_set.all.exists %}
        <button class="btn btn-primary" name = "house" value = "out_all"><span>실외</span></button>
        {% endif %}
        <button class="btn btn-primary" name = "house" value = "in_all"><span>실내</span></button>
        {% for gcg in user.gcg_set.all %}
        <button class="btn btn-primary" name = "house" value = "{{ gcg.id }}"><span>{{forloop.counter}} 동</span></button>
        {% endfor %}
    </form>
  </div>
</div>
    {% if house_cctv %}
    {% else %}
{# 각 동의 실외 실내 CCTV 출력을 위한 form태그 #}
<h3>{{gcg}}</h3>
        {% if cctv_exists %}
<div class="control-nav">
  <div class="control-inner" style="position:relative; ">
    <form action="" method="get" class = "btn btn-group" role="group">
        <input type="hidden" name = "house" value = "{{gcg.id}}">
        <input type="hidden" name = "type" value = "o">
        <input type = "submit" value = "실외" class = "btn btn-primary">
        </form>
        {% endif %}
        <form action="" method="get" class = "btn btn-group" role="group">
        <input type="hidden" name = "house" value = "{{gcg.id}}">
        <input type="hidden" name = "type" value = "i">
        <input type = "submit" value = "실내" class = "btn btn-primary">
            </form>
    </div>
</div>
    {% endif %}
<div class="control-content">
  {% if house_cctv %}
    {% if all_house_cctv %}
    <h3>농가 전체 실외 CCTV</h3>
    {% for cctv in all_house_cctv %}
    <div class = "cctv">농가 전체 실외 CCTV {{forloop.counter}}</div>
    {% endfor %}
    {% endif %}
    <h3>각동 {{house_cctv.0.get_cctv_type_display}} CCTV</h3>
    {% for cctv in house_cctv %}
    <div class = "cctv">{{cctv.gcg}} {{ cctv.get_cctv_type_display }} CCTV {{ forloop.counter }}</div>
    {% endfor %}
  {% else %}
  {% for cctv in gcg_cctv %}
    <div class = "cctv">{{cctv.gcg}} {{ cctv.get_cctv_type_display }} CCTV {{ forloop.counter }}</div>
  {% endfor %}
  <hr>
  {% endif %}

  {% if all_house_cctv %}

  {% else %}
    {% filter snode snode_type='t' as temp_snode %}
    {% filter snode snode_type='h' as humd_snode %}
    <h2>Snode Value</h2>
    <div class="">
      <table class="sensor-table">
        <thead>
          <th>온도</th>
          <th>습도</th>
          <th>CO2</th>
          <th>광량</th>
          <th>배지온도</th>
          <th>배지습도</th>
          <th>배지EC</th>
        </thead>
        <tbody>
          <!--
          {{temp_snode.0}}
          {{humd_snode.0}}-->
          {# 이후 sensor value 를 받는 테스트를 할때 같이 진행 #}
          {# 위와같이 temp_snode.0 과 같은 방식이 아닌 센서값의 평균을 구하는 것이므로 template tag 함수정의로 해결 #}
          <td>37</td>
          <td>66%</td>
          <td>33%</td>
          <td>28</td>
          <td>37도</td>
          <td>66%</td>
          <td>0.1</td>
        </tbody>

      </table>
    </div>

{% if house_cctv %}
  {% else %}
    <h2>Anode Control</h2>
      {% filter anode anode_type='oc' as oc_anode %}
      {% filter anode anode_type='wm' as wm_anode %}

    <h3>Open and Close Anode</h3>
    {% for oc in oc_anode %}
      <div class = "btn btn-primary">{{oc}}</div>
      <a href="{% url "data:anode_request" gcg.id oc.id %}" class = "btn btn-primary">Anode Control</a>
    {% endfor %}

    <h3>Wartering Motor</h3>
    {% for wm in wm_anode %}
      <div class = "btn btn-primary">{{wm}}</div>
      <a href="{% url "data:anode_request" gcg.id wm.id %}" class = "btn btn-primary">Anode Control</a>
    {% endfor %}
  {% endif %}
  {% endif %}
</div>

{% endblock %}
